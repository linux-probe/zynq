#### boot mode

启动模式和strap pin配置

| 启动模式 | MIO[5] | MIO[4] | MIO[3] | MIO[2] |
| :--- | :----: | :----: | :----: | :----: |
| jtag |   0    |   0    |   0    |   0    |
| qspi |   1    |   0    |   0    |   0    |
| sd   |   1    |   1    |   0    |   0    |

在板子上MIO[5]固定为高电平,MIO[3],MIO[2]固定为低电平，所以可以通过MIO[4]选择是qspi启动还是SD卡启动。**MIO[4]拨打ON表示接地，为QSPI启动**

#### CLK：

MIO[6]为低电平，PLL Bypassed模式，直接使用100M clk

#### SDK jtag不能连接成功

使用SDK调试的时候需要拔掉SD卡，因为SD卡里面有启动镜像。拔掉后，bootrom找不到启动镜像，会变为jtag启动。

#### OCM Address Mapping

需要考虑的事情：

1. 256K RAM可以被映射到低地址范围（0x0000_0000 to 0x0003_FFFF ）或该地址范围（0xFFFC_0000 to 0xFFFF_FFFF ），映射的粒度为64KB section共有4个人，通过4 bit寄存器slcr.OCM_CFG[RAM_HI] 进行配置。


2. SCU地址过滤功能可以把地址0x0000_0000 to 0x000F_FFFF（默认情况），该地址范围包含OCM的低地址范围，重定位到PS DDR DRAM，这和RAM地址设置是独立的。


3. 对于映射到高地址的OCM地址，每一个64KB section 不在SCU的地址过滤范围之内（因为SCU的映射粒度是1M，所以OCM为高地址，就不再OCM的范围之内了）将会成为CPU和ACP master地址范围0x000C_0000-0x000F_FFFF 的一个别名。访问这个地址和访问高地址空间是一个效果。
4. 其他不通过SCU的master不能访问DDR的低512K空间（是在CPU将低地址全部影射为DDR空间时，既都重定向到L2 cache controller）。是因为，其他的master都是安装固定的地址解码机制，其他master看到的OCM的地址范围为0x0000_0000 to 0x0007_FFFF 或者address 0xFFFC_0000 to 0xFFFF_FFFF 。所以OCM映射到低地址，其他master就不能访问0x0000_0000 to 0x0007_FFFF了。


#### 初始化地址映射

在系统上电复位后，进入user模式，OCM的128K被映射到低地址空间，另外64K被映射到高地址空间。

#### SCU

##### Address Filtering 

One of the functions of the SCU is to filter transactions that are generated by the processors and the ACP based on their addresses and route them accordingly to the OCM or L2 controller. The granularity of the address filtering within the SCU is 1 MB; therefore, all accesses by the processors or through the ACP whose addresses are within a 1 MB window can only target the OCM or L2 controller. **The default setting of the address filtering within the SCU routes all the upper and lower 1M addresses within the 4G address space to the OCM and the rest of the addresses are routed to the L2 controller.**

SCU地址过滤范围通过使用下面两个寄存器进行配置：

| mpcore.Filtering_Start_Address_Register | 0x0010_0000 |
| --------------------------------------- | ----------- |
| mpcore.Filtering_End_Address_Register   | 0xFFE0_0000 |

映射的粒度值1M，在start和end地址范围内的地址会把发送到L2  controller ，剩下的发往OCM。

#### Boot and Configuration 

##### BootROM

在PS_POB_B reset pin deassert,硬件采样boot strap pin并且可能使用PS clock PLLs，然后PS执行BootROM代码。非POP reset也会执行BootROM但是不会进行硬件采样strip pins。BootROM运行在CPU0，CPU1在wait-for-event状态。

> assert: Drive a signal to its active voltage level, either high or low.
> deassert: Drive a signal to its inactive voltage level, either high or low.

BootROM主要工作：配置system，辅助Boot Image FSBL/User code从boot device到OCM。然后跳转到OCM执行代码。FSBL/User code也可以在Quad-SPI或NOR设备上直接执行，在非安全环境。

##### FSBL/User Code

FSBL/User code执行的操作：

- 使用PS7 Init 初始化PS（MIO，DDR等）
- 使用bitstream烧写PL（如果提供了）
- 价值第二阶段bootloader或bare-metal到DDR memory
- 把系统控制交给第二阶段bootloader或者bare-metal应用程序 







 


